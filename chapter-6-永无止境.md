# Chapter 6: 永无止境: 网站的伸缩性框架

## 网站架构的伸缩性设计
* 根据功能进行物理分离实现伸缩: 不同的服务器不是不同的服务, 提供不同的服务
* 单一功能通过集群实现伸缩: 集群内的多台服务器部署相同的服务, 提供相同的服务

### 不同功能进行物理分离实现伸缩
* 纵向分离(分层后分离): 将业务处理流程上不同部分分离部署
* 横向分离(业务分割后分离): 将不同的业务模块分离部署

### 单一功能通过集群实现伸缩
* 应用服务器集群伸缩性
* 分布式缓存集群的伸缩性设计
* 数据服务器集群伸缩性

## 应用服务器集群伸缩性设计

### 负载均衡服务器
* HTTP重定向负载均衡
* DNS域名解析负载均衡
* 反向代理负载均衡(应用层负载均衡)
* IP负载均衡(网络层负载均衡)
* MAC负载均衡(数据链路层负载均衡)

### 负载均衡算法
* 轮询(Round Robin, RR)
* 加权轮询(Weighted Round Robin, WRR)
* 随机(Random)
* 最少链接(Least Connections)
* 源地址散列(Source Hashing)

## 分布式缓存集群的伸缩性设计

### 路由算法
* 余数Hash: 
    - 用服务器数据除以缓存数据KEY的Hash值, 余数为服务器的序号. 
    - 当添加服务器时, 不命中概率为(N/(N+1))
* 一致性Hash环: 
    - 构造一个长度为2^32的整数环, 根据节点名称的Hash值将缓存服务器结点放置在这个Hash环上,
        然后根据需要缓存的数据KEY值计算的到期Hash值, 然后在Hash环上顺时针查找距离这个KEY的Hash值最近的缓存服务器节点.
    - Hash查找实在二叉查找树中查找不小于查找数的最小值.(树的最右叶子节点和最左叶子节点相连接, 构成环)
    - 为解决增加服务器各节点负载不均衡的问题, 可以增加一个虚拟层来解决, 将每台物理缓存服务器虚拟为一组虚拟缓存无服务器(经验值为150), 
        KEY在环上先找到虚拟服务器节点, 在得到物理服务器信息.
    - 当心无力服务节点加入时, 是将一组虚拟节点加入环中.如果虚拟节点数目足够多, 将会较为均匀地影响原来集群中已经存在的所有服务器.

## 数据存储服务器的伸缩性设计
缓存的目的是加速数据的读取速度并减轻数据存储服务器的复杂压力, 因此部分缓存数据的丢失不影响业务的正常处理, 因为数据还可以从数据库等存储服务器上获取.

数据存储服务器必须保证数据的可靠存储, 任何情况下都必须保证数据的可用性和正确性.

### 关系数据库集群的伸缩性设计
* 主从读写分离
* 数据分库(不同业务数据表部署在不同的数据库集群上)
* 数据分片(将一张表拆开分别存储在多个数据库中)

### NoSQL数据库的伸缩性设计
NoSQL, 主要指非关系的, 分布式的数据库设计模式. 也可解读为Not Only SQL, 标识NoSQL只是关系数据库的补充, 而不是替代方案.

一般而言, NoSQL数据库产品都放弃了关系数据库的两大重要基础: 以关系代数为基础的机构化查询语言(SQL)和事务一致性保证(ACID),
而强化其他一些大型网站更关注的特性: 高可用性和可伸缩性.

[Home](README.md), [Previous](chapter-5-万无一失.md), [Next](chapter-7-随机应变.md)


